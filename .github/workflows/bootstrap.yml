name: Bootstrap Handball Site
on:
  push:
    paths:
      - ".github/workflows/bootstrap.yml"

permissions:
  contents: write

jobs:
  scaffold:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate project tree
        run: |
          set -eu
          mkdir -p public/assets public/data public/scripts/lib public/scripts/datafeeds public/scripts/ui .github/workflows

          ############
          # README.md
          ############
          cat > README.md <<'EOF'
          # ASV Handball ‚Äì GitHub Pages (ohne PWA)
          Moderne Sportseite: Live-Daten (nuLiga), Tabelle/Spielplan, Countdown, Formkurve (SVG),
          Jubel-Button (Konfetti+Sound), News (RSS optional), Dark/Light, Mobile-First.
          **Keine** Offline/PWA-Komplexit√§t. Deployment: GitHub Pages aus `/public`.

          ## Konfiguration
          `public/scripts/config.js`:
          - `nuliga.tableUrl` & `nuliga.scheduleUrl` setzen
          - optional `corsProxy: "https://r.jina.ai/http://"` bei CORS-Block
          - `clubFilter` (z. B. "ASV"), Branding (Name/Slogan)

          ## Lokal testen
          `cd public && python -m http.server 8080` ‚Üí http://localhost:8080

          Lizenz: MIT ¬∑ ‚ÄûFair. Vollgas. ASV!‚Äú
          EOF

          ##################
          # public/index.html
          ##################
          cat > public/index.html <<'EOF'
          <!doctype html>
          <html lang="de" data-theme="auto">
          <head>
            <meta charset="utf-8"/>
            <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
            <title>ASV Handball ¬∑ Live</title>
            <meta name="description" content="ASV Handball ‚Äì Live Scores, Tabelle, Spielplan. Fair. Vollgas. ASV!">
            <meta name="color-scheme" content="light dark">
            <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
            <link rel="preload" as="style" href="./styles.css"/>
            <link rel="stylesheet" href="./styles.css" media="print" onload="this.media='all'">
            <noscript><link rel="stylesheet" href="./styles.css"></noscript>
            <style>
              html,body{height:100%} body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Inter,Arial}
              .wrap{max-width:1120px;margin:auto;padding:16px}
              .sr-only{position:absolute;width:1px;height:1px;margin:-1px;clip:rect(0,0,0,0);overflow:hidden}
            </style>
          </head>
          <body>
          <a class="sr-only" href="#content">Zum Inhalt springen</a>
          <div class="wrap">
            <header class="app" aria-label="Seitenkopf">
              <div class="brand">
                <img src="./assets/icon.svg" alt="" class="logo" width="40" height="40" aria-hidden="true">
                <div class="brand-lines">
                  <strong id="brand-title">ASV Handball</strong>
                  <span class="muted" id="brand-sub">Fair. Vollgas. ASV!</span>
                </div>
              </div>
              <nav class="actions" aria-label="Aktionen">
                <button id="btn-share" class="btn" aria-label="Seite teilen">Teilen</button>
                <button id="btn-theme" class="btn" aria-pressed="false" aria-label="Theme wechseln">üåó</button>
              </nav>
            </header>

            <main id="content" class="grid-3" aria-live="polite">
              <section class="card hero">
                <div class="hero-left">
                  <h1 id="hero-title">‚ÄûVolle Halle. Volle Herzen.‚Äú</h1>
                  <p class="muted">Live-Scores, Tabelle & Spielplan ‚Äì jetzt mit Konfetti-Risiko.</p>
                  <div class="cta-row">
                    <a href="#schedule" class="btn primary">Zum Spielplan</a>
                    <button class="btn" id="btn-cheer">üéâ Jubel!</button>
                  </div>
                </div>
                <div class="hero-right">
                  <div class="badge">Form: <strong id="form-value">‚Äì</strong></div>
                  <div class="countdown" id="countdown">‚Äì</div>
                </div>
              </section>

              <section class="card" id="table" aria-labelledby="table-h">
                <div class="card-head">
                  <h2 id="table-h">Tabelle</h2>
                  <div class="filters">
                    <label class="badge"><input id="flt-top" type="checkbox" checked> Top-3</label>
                    <span class="badge">‚è± <time id="tbl-updated">‚Äì</time></span>
                  </div>
                </div>
                <div id="table-body"><div class="skeleton h-240"></div></div>
                <div class="sparkline-wrap">
                  <svg id="form-spark" viewBox="0 0 100 30" role="img" aria-label="Formkurve letzte 5 Spiele"></svg>
                </div>
              </section>

              <section class="card" id="schedule" aria-labelledby="schedule-h">
                <div class="card-head">
                  <h2 id="schedule-h">Spielplan & Ergebnisse</h2>
                  <div class="filters">
                    <label class="badge"><input id="flt-only-asv" type="checkbox" checked> nur ASV</label>
                    <label class="badge"><input id="flt-upcoming" type="checkbox" checked> bevorstehend</label>
                  </div>
                </div>
                <div id="schedule-body"><div class="skeleton h-240"></div></div>
                <details id="iframe-fallback" class="mt-10" hidden>
                  <summary>Fallback: Original-Ansicht (nuLiga)</summary>
                  <iframe id="iframe-el" title="nuLiga Fallback" loading="lazy"></iframe>
                </details>
              </section>

              <section class="card" id="roster" aria-labelledby="roster-h">
                <div class="card-head">
                  <h2 id="roster-h">Team & Trainer</h2>
                  <span class="badge">Humor inside ü§ù</span>
                </div>
                <div id="roster-body"><div class="skeleton h-200"></div></div>
              </section>

              <section class="card" id="news" aria-labelledby="news-h">
                <div class="card-head">
                  <h2 id="news-h">Schlagzeilen</h2>
                  <span class="muted">Quelle: handball-world (RSS, sofern erlaubt)</span>
                </div>
                <div id="news-body"><div class="skeleton h-160"></div></div>
              </section>
            </main>

            <footer class="muted center">
              <small>¬© <span id="year"></span> ASV Handball ¬∑ ‚ÄûWirf‚Äôs wie du‚Äôs f√ºhlst.‚Äú</small>
            </footer>
          </div>
          <script type="module" src="./scripts/app.js" defer></script>
          </body>
          </html>
          EOF

          #################
          # public/styles.css
          #################
          cat > public/styles.css <<'EOF'
          :root{
            --asv-blue:#0046AD; --asv-red:#E21B23;
            --bg:#0B1020; --bg-soft:#12182b; --fg:#E9ECF4; --muted:#9aa4bf; --card:#0f1526;
            --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
            --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.25);
            --border:#ffffff14; --transition:220ms ease;
          }
          @media (prefers-color-scheme: light){
            html[data-theme="auto"] :root{--bg:#f6f8ff;--bg-soft:#ffffff;--fg:#0b1020;--muted:#5c6680;--card:#ffffff;--border:#0001}
          }
          html[data-theme="light"] :root{--bg:#f6f8ff;--bg-soft:#ffffff;--fg:#0b1020;--muted:#5c6680;--card:#ffffff;--border:#0001}

          .wrap{max-width:1120px;margin:auto;padding:16px}
          .app{display:flex;gap:12px;align-items:center;justify-content:space-between}
          .brand{display:flex;gap:12px;align-items:center}
          .logo{width:40px;height:40px;border-radius:12px;box-shadow:var(--shadow)}
          .brand-lines strong{letter-spacing:.3px}
          .actions{display:flex;gap:8px;align-items:center}
          .grid-3{display:grid;gap:16px}
          @media(min-width:980px){.grid-3{grid-template-columns:2fr 1fr;grid-auto-rows:min-content}}
          .center{text-align:center}

          .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
          .card-head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
          .badge{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;background:#ffffff14;border:1px solid var(--border)}
          .muted{color:var(--muted)}

          .hero{display:grid;gap:16px}
          @media(min-width:980px){.hero{grid-template-columns:1.5fr 1fr}}
          .hero .cta-row{display:flex;gap:8px;align-items:center}
          .countdown{font-variant-numeric:tabular-nums;font-size:1.2rem;margin-top:8px}

          .btn{border:0;border-radius:999px;padding:10px 14px;cursor:pointer;background:var(--bg-soft);color:var(--fg);transition:transform var(--transition),opacity var(--transition)}
          .btn:hover{transform:translateY(-1px)}
          .btn.primary{background:linear-gradient(135deg,var(--asv-blue),var(--asv-red));color:#fff}

          .table{width:100%;border-collapse:collapse;font-variant-numeric:tabular-nums}
          .table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
          .table tr[data-asv="true"]{background:linear-gradient(90deg,transparent,rgba(226,27,35,.08),transparent)}
          .table tr:hover{background:#ffffff08}
          .skeleton{position:relative;overflow:hidden;background:linear-gradient(90deg,#ffffff10,#ffffff05,#ffffff10);border-radius:12px}
          .skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);transform:translateX(-100%);animation:shimmer 1.2s infinite}
          @keyframes shimmer{to{transform:translateX(100%)}}
          .h-240{height:240px}.h-200{height:200px}.h-160{height:160px}
          .mt-10{margin-top:10px}

          #iframe-el{width:100%;height:520px;border:0;border-radius:12px;margin-top:10px}
          .sparkline-wrap{margin-top:10px}
          svg#form-spark{width:100%;height:40px}
          EOF

          ########################
          # public/assets/icon.svg
          ########################
          cat > public/assets/icon.svg <<'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96" role="img" aria-label="ASV Icon">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#0046AD"/>
                <stop offset="1" stop-color="#E21B23"/>
              </linearGradient>
            </defs>
            <rect rx="20" width="96" height="96" fill="url(#g)"/>
            <g fill="#fff">
              <circle cx="48" cy="48" r="22" opacity=".15"/>
              <path d="M25 60l10-32h8l10 32h-8l-2-7H33l-2 7h-6zm12-14h7l-3-11h-1l-3 11z"/>
              <circle cx="74" cy="28" r="6"/>
            </g>
          </svg>
          EOF

          #############################
          # public/assets/favicon.svg
          #############################
          cat > public/assets/favicon.svg <<'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96">
            <rect rx="20" width="96" height="96" fill="#0046AD"/>
            <circle cx="72" cy="24" r="8" fill="#E21B23"/>
            <path d="M25 60l10-32h8l10 32h-8l-2-7H33l-2 7h-6zM37 46h7l-3-11h-1l-3 11z" fill="#fff"/>
          </svg>
          EOF

          #############################
          # public/data/roster.json
          #############################
          cat > public/data/roster.json <<'EOF'
          {
            "players": [
              { "nr": 1, "name": "Mika \"Mauer\" K.", "pos": "TW", "vibe": "Reflexe wie ein Panther üêÜ" },
              { "nr": 7, "name": "Lio ‚ÄûLaser‚Äú S.", "pos": "RL", "vibe": "Winkel? Kennt er alle üìê" },
              { "nr": 10, "name": "Yuna ‚ÄûYEAH-na‚Äú S.", "pos": "RR", "vibe": "Dreher-Queen üîÑ" },
              { "nr": 13, "name": "Leo ‚ÄûLaufwunder‚Äú B.", "pos": "LA", "vibe": "Konter-Kilometerz√§hler üèÉ‚Äç‚ôÇÔ∏è" }
            ],
            "staff": [
              { "role": "Head Coach", "name": "Coach K.", "fact": "Motivations-Playlist > Gegneranalyse üéß" },
              { "role": "Co-Trainer", "name": "Taktik T.", "fact": "Time-Out-Zeitfl√ºsterer ‚è±Ô∏è" }
            ]
          }
          EOF

          ###################################
          # public/data/schedule.sample.json
          ###################################
          cat > public/data/schedule.sample.json <<'EOF'
          [
            { "date": "2025-11-15T13:00:00", "home": "ASV S√ºchteln", "away": "HC Beispiel", "result": null },
            { "date": "2025-11-01T13:00:00", "home": "ASV S√ºchteln", "away": "SG Muster", "result": "22:20" },
            { "date": "2025-10-25T16:00:00", "home": "HSV Demo", "away": "ASV S√ºchteln", "result": "18:18" },
            { "date": "2025-10-18T14:30:00", "home": "ASV S√ºchteln", "away": "TV Sample", "result": "17:19" },
            { "date": "2025-10-11T14:00:00", "home": "ASV S√ºchteln", "away": "SC Probe", "result": "24:19" },
            { "date": "2025-10-04T14:00:00", "home": "SC Test", "away": "ASV S√ºchteln", "result": "21:23" }
          ]
          EOF

          #############################
          # public/scripts/config.js
          #############################
          cat > public/scripts/config.js <<'EOF'
          export const CONFIG = {
            branding: {
              teamName: "ASV S√ºchteln",
              slogan: "Fair. Vollgas. ASV!",
              heroTitle: "‚ÄûVolle Halle. Volle Herzen.‚Äú"
            },
            colors: { primary: "#0046AD", accent: "#E21B23" },
            clubFilter: "ASV",
            nuliga: {
              mode: "html", // "json" oder "html"
              tableUrl: "https://example.com/nuliga/tabelle",
              scheduleUrl: "https://example.com/nuliga/spielplan",
              // Wenn CORS blockt: Proxy (read-only), z. B. "https://r.jina.ai/http://"
              corsProxy: ""
            },
            news: { rssUrl: "", corsProxy: "" }
          };
          EOF

          ########################
          # public/scripts/lib/*
          ########################
          cat > public/scripts/lib/dom.js <<'EOF'
          export const $ = (sel, root = document) => root.querySelector(sel);
          export const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
          export const el = (tag, props = {}, ...children) => {
            const n = Object.assign(document.createElement(tag), props);
            for (const c of children.flat()) if (c != null) n.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
            return n;
          };
          export const clear = (node) => (node.innerHTML = "", node);
          export const time = (d) => (d instanceof Date ? d : new Date(d));
          export const fmtDate = (d) => time(d).toLocaleDateString([], { day:"2-digit", month:"2-digit", year:"numeric" });
          export const fmtTime = (d) => time(d).toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" });
          EOF

          cat > public/scripts/lib/storage.js <<'EOF'
          const SCOPE = "asv-live";
          export const put = (key, value) => localStorage.setItem(`${SCOPE}:${key}`, JSON.stringify({ t: Date.now(), value }));
          export const get = (key) => {
            try { const raw = localStorage.getItem(`${SCOPE}:${key}`); return raw ? JSON.parse(raw) : null; }
            catch { return null; }
          };
          EOF

          cat > public/scripts/lib/sparkline.js <<'EOF'
          export function renderSparkline(svgEl, values = []) {
            const w = 100, h = 30, p = 2;
            svgEl.setAttribute("viewBox", `0 0 ${w} ${h}`);
            while (svgEl.firstChild) svgEl.removeChild(svgEl.firstChild);
            if (!values.length) return;
            const step = (w - 2*p) / (values.length - 1 || 1);
            const pts = values.map((v,i) => [p + i * step, h - p - v * (h - 2*p)]);
            const d = pts.map((p,i) => (i ? "L" : "M") + p[0] + " " + p[1]).join(" ");
            const path = document.createElementNS("http://www.w3.org/2000/svg","path");
            path.setAttribute("d", d);
            path.setAttribute("fill","none");
            path.setAttribute("stroke","currentColor");
            path.setAttribute("stroke-width","2");
            svgEl.appendChild(path);
          }
          EOF

          ##################################
          # public/scripts/datafeeds/*
          ##################################
          cat > public/scripts/datafeeds/nuliga.js <<'EOF'
          import { CONFIG } from "../config.js";
          const withProxy = (url, proxy) => proxy ? proxy + url : url;

          export async function fetchTable() {
            const url = withProxy(CONFIG.nuliga.tableUrl, CONFIG.nuliga.corsProxy);
            if (CONFIG.nuliga.mode === "json") {
              const res = await fetch(url); if (!res.ok) throw new Error("Table fetch failed");
              const json = await res.json(); return normalizeTableFromJson(json);
            }
            const html = await fetchHtml(url);
            return parseTableFromHtml(html);
          }

          export async function fetchSchedule() {
            const url = withProxy(CONFIG.nuliga.scheduleUrl, CONFIG.nuliga.corsProxy);
            if (CONFIG.nuliga.mode === "json") {
              const res = await fetch(url); if (!res.ok) throw new Error("Schedule fetch failed");
              const json = await res.json(); return normalizeScheduleFromJson(json);
            }
            const html = await fetchHtml(url);
            return parseScheduleFromHtml(html);
          }

          async function fetchHtml(url) {
            const res = await fetch(url, { mode: CONFIG.nuliga.corsProxy ? "cors" : "no-cors" });
            if (!res.ok || res.type === "opaque") { const err = new Error("CORS or opaque"); err.code="OPAQUE"; throw err; }
            return await res.text();
          }

          function parseTableFromHtml(html) {
            const doc = new DOMParser().parseFromString(html, "text/html");
            const table = doc.querySelector("table"); if (!table) throw new Error("No table found");
            const rows = Array.from(table.querySelectorAll("tbody tr, tr")).filter(r => r.querySelectorAll("td").length >= 4);
            const out = rows.map((tr) => {
              const td = tr.querySelectorAll("td");
              const text = [...td].map(x => x.textContent.replace(/\s+/g," ").trim());
              const team = text.find(t => /[A-Za-z√Ñ√ñ√ú√§√∂√º]/.test(t)) || "";
              const rank = Number(text[0].replace(/\D+/g,"")) || null;
              const games = Number(text.find(t => /^\d+$/.test(t))) || null;
              const pts = Number((text.at(-1)||"").replace(/\D+/g,"")) || null;
              const diff = (() => { const d = text.find(t => /[+\-]\d+/.test(t)); return d ? Number(d.replace(/[^\-0-9]/g,"")) : null; })();
              return { rank, team, games, diff, points: pts };
            }).filter(x => x.team);
            return dedupe(out,"team").sort((a,b)=>(a.rank??999)-(b.rank??999) || (b.points??0)-(a.points??0));
          }

          function parseScheduleFromHtml(html) {
            const doc = new DOMParser().parseFromString(html, "text/html");
            const table = doc.querySelector("table"); if (!table) throw new Error("No schedule table");
            const rows = Array.from(table.querySelectorAll("tbody tr, tr")).filter(r => r.querySelectorAll("td").length >= 4);
            const evts = rows.map((tr) => {
              const td = tr.querySelectorAll("td");
              const cells = [...td].map(x => x.textContent.replace(/\s+/g," ").trim());
              const dateStr = cells.find(c => /\d{1,2}\.\d{1,2}\.\d{2,4}/.test(c)) || "";
              const timeStr = cells.find(c => /\d{1,2}:\d{2}/.test(c)) || "00:00";
              const [d,m,y] = (dateStr.match(/(\d{1,2})\.(\d{1,2})\.(\d{2,4})/) || []).slice(1).map(Number);
              const date = y ? new Date((y<100?2000+y:y), m-1, d, +timeStr.split(":")[0], +timeStr.split(":")[1]) : null;
              const home = cells[2] || "", away = cells[3] || "";
              const res = cells.find(c => /^\d+\s*:\s*\d+$/.test(c)) || null;
              return { date, home, away, result: res };
            }).filter(e => e.home && e.away && e.date instanceof Date && !isNaN(+e.date));
            return evts.sort((a,b)=>+a.date-+b.date);
          }

          function normalizeTableFromJson(json) {
            return (json.teams||[]).map((t,i)=>({ rank:i+1, team:t.name, games:t.games, diff:t.goalDiff, points:t.points }));
          }
          function normalizeScheduleFromJson(json) {
            return (json.matches||[]).map(m => ({ date:new Date(m.date), home:m.home, away:m.away, result:m.result??null }));
          }
          function dedupe(arr,key){ const s=new Set(), out=[]; for(const it of arr){ if(it[key]&&!s.has(it[key])){s.add(it[key]); out.push(it);} } return out; }
          EOF

          cat > public/scripts/datafeeds/news.js <<'EOF'
          import { CONFIG } from "../config.js";
          export async function fetchNews(max = 6) {
            if (!CONFIG.news.rssUrl) return [];
            const url = CONFIG.news.corsProxy ? CONFIG.news.corsProxy + CONFIG.news.rssUrl : CONFIG.news.rssUrl;
            try {
              const res = await fetch(url, { mode: CONFIG.news.corsProxy ? "cors" : "no-cors" });
              if (!res.ok || res.type === "opaque") throw new Error("rss opaque");
              const xml = await res.text();
              const doc = new DOMParser().parseFromString(xml, "application/xml");
              const items = [...doc.querySelectorAll("item")].slice(0, max).map(x=>({
                title: x.querySelector("title")?.textContent?.trim() || "News",
                link: x.querySelector("link")?.textContent?.trim() || "#",
                date: new Date(x.querySelector("pubDate")?.textContent || Date.now())
              }));
              return items;
            } catch { return []; }
          }
          EOF

          #############################
          # public/scripts/ui/*
          #############################
          cat > public/scripts/ui/cheer.js <<'EOF'
          export function setupCheer(button) {
            if (!button) return;
            button.addEventListener("click", () => {
              confetti(button);
              playCheer();
              button.disabled = true;
              setTimeout(() => (button.disabled = false), 1200);
            });
          }
          function confetti(anchor){
            const n = 28, rect = anchor.getBoundingClientRect();
            for (let i=0;i<n;i++){
              const p = document.createElement("span");
              p.className = "confetti";
              Object.assign(p.style, {
                position:"fixed", left: (rect.left + rect.width/2) + "px", top:(rect.top) + "px",
                width:"8px", height:"8px", background: i%2? "var(--asv-red)":"var(--asv-blue)",
                transform:`translate(${(Math.random()-0.5)*160}px, -${Math.random()*60}px) rotate(${Math.random()*360}deg)`,
                borderRadius:"2px", transition:"transform .9s ease, opacity .9s ease", zIndex:9999
              });
              document.body.appendChild(p);
              requestAnimationFrame(()=>{ p.style.opacity="0"; p.style.transform=`translate(${(Math.random()-0.5)*300}px, ${220+Math.random()*120}px) rotate(${Math.random()*720}deg)`; });
              setTimeout(()=>p.remove(), 950);
            }
          }
          function playCheer(){
            try {
              const ctx = new (window.AudioContext||window.webkitAudioContext)();
              const dur = 0.9;
              const noise = ctx.createBufferSource();
              const buf = ctx.createBuffer(1, ctx.sampleRate*dur, ctx.sampleRate);
              const data = buf.getChannelData(0);
              for (let i=0;i<data.length;i++){ data[i] = (Math.random()*2-1) * (1 - i/data.length); }
              noise.buffer = buf;
              const band = ctx.createBiquadFilter(); band.type="bandpass"; band.frequency.value=1500; band.Q.value=0.7;
              const gain = ctx.createGain(); gain.gain.setValueAtTime(0.0001, ctx.currentTime);
              gain.gain.exponentialRampToValueAtTime(0.7, ctx.currentTime + 0.08);
              gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur);
              noise.connect(band).connect(gain).connect(ctx.destination);
              noise.start(); noise.stop(ctx.currentTime + dur);
            } catch {}
          }
          EOF

          cat > public/scripts/ui/components.js <<'EOF'
          import { el, clear, fmtDate, fmtTime } from "../lib/dom.js";
          import { CONFIG } from "../config.js";
          import { renderSparkline } from "../lib/sparkline.js";

          export function renderTable(root, rows, { top3 = true } = {}) {
            clear(root);
            if (!rows?.length) return root.append(el("p", { className:"muted" }, "Keine Tabellendaten."));
            const data = top3 ? rows.slice(0,3) : rows;
            const tbl = el("table", { className:"table fade-in", role:"table", "aria-label":"Ligatabelle" },
              el("thead", {}, el("tr", {},
                el("th", {}, "#"), el("th", {}, "Team"), el("th", {}, "Sp."), el("th", {}, "Diff"), el("th", {}, "Pkt.")
              )),
              el("tbody", {}, data.map(r => el("tr", { "data-asv": String(r.team.includes(CONFIG.clubFilter)) },
                el("td", {}, r.rank ?? "‚Äì"),
                el("td", {}, r.team),
                el("td", {}, r.games ?? "‚Äì"),
                el("td", {}, r.diff ?? "‚Äì"),
                el("td", {}, r.points ?? "‚Äì"),
              )))
            );
            root.append(tbl);
          }

          export function renderSchedule(root, games, { onlyASV = true, upcoming = true } = {}) {
            clear(root);
            if (!games?.length) return root.append(el("p", { className:"muted" }, "Keine Spiele gefunden."));
            let list = games.slice().sort((a,b)=>+a.date-+b.date);
            if (onlyASV) list = list.filter(g => [g.home, g.away].some(n => n?.includes(CONFIG.clubFilter)));
            if (upcoming) list = list.filter(g => +g.date >= Date.now() - 2*3600e3);
            const tbl = el("table", { className:"table fade-in", role:"table", "aria-label":"Spielplan" },
              el("thead", {}, el("tr", {}, el("th", {}, "Datum"), el("th", {}, "Zeit"), el("th", {}, "Heim"), el("th", {}, "Gast"), el("th", {}, "Ergebnis"))),
              el("tbody", {}, list.map(g => el("tr", {},
                el("td", {}, fmtDate(g.date)),
                el("td", {}, fmtTime(g.date)),
                el("td", {}, g.home),
                el("td", {}, g.away),
                el("td", {}, g.result ?? "‚Äì")
              )))
            );
            root.append(tbl);
          }

          export function renderNextAndForm(countdownEl, formTextEl, formSparkEl, schedule, clubFilter) {
            const now = Date.now();
            const next = schedule?.find(g => +g.date >= now);
            if (next) updateCountdown(countdownEl, next.date); else countdownEl.textContent = "Kein anstehendes Spiel.";
            const last5 = schedule?.filter(g => +g.date < now && g.result)?.slice(-5) || [];
            const seq = last5.map(g => {
              const [a,b] = g.result.split(":").map(n=>parseInt(n,10));
              const asvHome = g.home.includes(clubFilter), asvAway = g.away.includes(clubFilter);
              const asv = asvHome ? a : asvAway ? b : null;
              const opp = asvHome ? b : asvAway ? a : null;
              if (asv == null || opp == null) return 0.5;
              return asv > opp ? 1 : asv === opp ? 0.5 : 0;
            });
            formTextEl.textContent = seq.map(v => v===1?"W":v===0.5?"D":"L").join(" ") || "‚Äì";
            renderSparkline(formSparkEl, seq.length ? seq : [0.5,0.5,0.5,0.5,0.5]);
          }

          export function updateCountdown(node, targetDate) {
            const tick = () => {
              const diff = +targetDate - Date.now();
              if (diff <= 0) { node.textContent = "Anwurf!"; return; }
              const s = Math.floor(diff/1000);
              const d = Math.floor(s/86400), h = Math.floor((s%86400)/3600), m = Math.floor((s%3600)/60), sec = s%60;
              node.textContent = `Start in ${d}d ${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
              requestAnimationFrame(()=>setTimeout(tick, 240));
            };
            tick();
          }

          export function renderRoster(root, roster) {
            clear(root);
            if (!roster?.players?.length) { root.append(el("p",{className:"muted"},"Noch kein Kader hinterlegt.")); return; }
            const list = el("div", { className:"fade-in" },
              ...roster.players.map(p => el("div", { className:"player-row", style:"display:flex;justify-content:space-between;border-bottom:1px solid var(--border);padding:8px 0" },
                el("div", {}, el("strong", {}, p.nr ? `#${p.nr} ` : ""), p.name, " ¬∑ ", el("span",{className:"muted"}, p.pos || "‚Äì")),
                el("div", {}, el("span", { className:"badge" }, p.vibe || "Teamplayer ü§ù"))
              ))
            );
            const staff = el("div", { style:"margin-top:10px" },
              el("h3", {}, "Trainerteam"),
              ...((roster.staff||[]).map(s => el("div", {}, s.role, ": ", el("strong",{},s.name), " ", el("span",{className:"muted"}, s.fact||""))))
            );
            root.append(list, staff);
          }

          export function renderNews(root, items) {
            clear(root);
            if (!items?.length) {
              root.append(el("p", {className:"muted"}, "Kein RSS-Zugriff ‚Äì √∂ffne handball-world direkt: ",
                el("a", { href:"https://www.handball-world.news/", target:"_blank", rel:"noopener" }, "handball-world")));
              return;
            }
            const ul = el("ul", { style:"list-style:none;margin:0;padding:0" },
              items.map(n => el("li", { style:"padding:6px 0;border-bottom:1px solid var(--border)" },
                el("a", { href:n.link, target:"_blank", rel:"noopener" }, n.title),
                " ", el("span", { className:"muted" }, `(${n.date.toLocaleDateString()})`)
              ))
            );
            root.append(ul);
          }
          EOF

          ##########################
          # public/scripts/app.js
          ##########################
          cat > public/scripts/app.js <<'EOF'
          import { $, el } from "./lib/dom.js";
          import { get, put } from "./lib/storage.js";
          import { CONFIG } from "./config.js";
          import { fetchTable, fetchSchedule } from "./datafeeds/nuliga.js";
          import { fetchNews } from "./datafeeds/news.js";
          import { renderTable, renderSchedule, renderNextAndForm, renderRoster, renderNews } from "./ui/components.js";
          import { setupCheer } from "./ui/cheer.js";

          const state = { table:null, schedule:null, opaque:false };

          $("#brand-title").textContent = CONFIG.branding.teamName;
          $("#brand-sub").textContent = CONFIG.branding.slogan;
          $("#hero-title").textContent = CONFIG.branding.heroTitle;
          $("#year").textContent = new Date().getFullYear();

          (function themeInit(){
            const saved = localStorage.getItem("asv-theme");
            if (saved) document.documentElement.setAttribute("data-theme", saved);
            $("#btn-theme").addEventListener("click", () => {
              const cur = document.documentElement.getAttribute("data-theme") || "auto";
              const next = cur === "auto" ? "light" : cur === "light" ? "dark" : "auto";
              document.documentElement.setAttribute("data-theme", next);
              localStorage.setItem("asv-theme", next);
              $("#btn-theme").setAttribute("aria-pressed", String(next !== "auto"));
            });
          })();

          $("#btn-share").addEventListener("click", async () => {
            const data = { title: `${CONFIG.branding.teamName} ¬∑ Live`, text: CONFIG.branding.slogan, url: location.href };
            try { if (navigator.share) await navigator.share(data); else { await navigator.clipboard.writeText(location.href); alert("Link kopiert ‚úÖ"); } }
            catch {}
          });

          const fltTop=$("#flt-top"), fltOnly=$("#flt-only-asv"), fltUpc=$("#flt-upcoming");
          fltTop.checked = true; fltOnly.checked = true; fltUpc.checked = true;
          fltTop.addEventListener("change", () => state.table && hydrateTable());
          fltOnly.addEventListener("change", () => state.schedule && hydrateSchedule());
          fltUpc.addEventListener("change", () => state.schedule && hydrateSchedule());

          setupCheer($("#btn-cheer"));

          (function(){
            const t=get("table"), s=get("schedule");
            if (t?.value){ state.table=t.value; hydrateTable(); setUpdated("#tbl-updated", t.t); }
            if (s?.value){ state.schedule = s.value.map(x=>({...x, date:new Date(x.date)})); hydrateSchedule(); renderNextAndForm($("#countdown"), $("#form-value"), $("#form-spark"), state.schedule, CONFIG.clubFilter); }
          })();

          fetch("./data/roster.json").then(r=>r.json()).then(j=>renderRoster($("#roster-body"), j)).catch(()=>{});
          fetchNews(6).then(items => renderNews($("#news-body"), items));

          init().catch(console.warn);

          async function init(){
            try{
              const [table, schedule] = await Promise.all([fetchTable(), fetchSchedule()]);
              state.table = table;
              state.schedule = schedule;
              put("table", table); put("schedule", schedule);
              hydrateTable(); hydrateSchedule();
              renderNextAndForm($("#countdown"), $("#form-value"), $("#form-spark"), state.schedule, CONFIG.clubFilter);
              setUpdated("#tbl-updated", Date.now());
            } catch (err){
              console.warn(err);
              if (err?.code==="OPAQUE"){ state.opaque = true; const details=$("#iframe-fallback"); const iframe=$("#iframe-el"); details.hidden=false; iframe.src = CONFIG.nuliga.tableUrl; }
              if (!state.schedule){
                try {
                  const res = await fetch("./data/schedule.sample.json"); const sample = await res.json();
                  state.schedule = sample.map(x=>({...x, date:new Date(x.date)}));
                  hydrateSchedule();
                  renderNextAndForm($("#countdown"), $("#form-value"), $("#form-spark"), state.schedule, CONFIG.clubFilter);
                } catch {}
              }
            }
          }

          function hydrateTable(){ renderTable($("#table-body"), state.table, { top3: fltTop.checked }); }
          function hydrateSchedule(){ renderSchedule($("#schedule-body"), state.schedule, { onlyASV: fltOnly.checked, upcoming: fltUpc.checked }); }
          function setUpdated(sel, t){ const el = document.querySelector(sel); if (el) el.textContent = new Date(t).toLocaleTimeString(); }
          EOF

          #########################################
          # GitHub Pages Deploy Workflow (pages.yml)
          #########################################
          cat > .github/workflows/pages.yml <<'EOF'
          name: Deploy to GitHub Pages
          on:
            push:
              branches: [ main ]
          permissions:
            contents: read
            pages: write
            id-token: write
          jobs:
            deploy:
              environment:
                name: github-pages
                url: ${{ steps.deployment.outputs.page_url }}
              runs-on: ubuntu-latest
              steps:
                - uses: actions/checkout@v4
                - uses: actions/configure-pages@v5
                - uses: actions/upload-pages-artifact@v3
                  with:
                    path: public
                - id: deployment
                  uses: actions/deploy-pages@v4
          EOF

      - name: Commit scaffold
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions
          author_email: 41898282+github-actions[bot]@users.noreply.github.com
          message: "bootstrap: scaffold handball site"
